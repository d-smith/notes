# ERC 4337 Account Abstraction

Use a smart contract as the basis of a users account, enabled via a system of higher level infrastructure that does not require a modification to the blockchain protocol.

How it works:

* A user's intent is packaged by the app into a psuedo transaction call a UserOperation
* A UserOperation can contain any number of transactions and the data needed to execute the transactions with smart contract accounts
* UserOperations are sent to a network of Bundlers. Bundlers can pull transactions from public mempools or private mempools. Bundlers package the UserOperations and send them to the blockchain.
* On the blockchain, a smart contract called the EntryPoint handles the verification and execution of these transactions by WalletContracts, smart contracts owned by a user.
* Other smart contracts, like paymasters and aggregators, can help sponsor transactions and aggregate signatures for better user experiences.

docs.stackup.sh - get started - quickstart guide

https://github.com/eth-infinitism/bundler

https://geth.ethereum.org/docs/developers/dapp-developer/dev-mode

Install:

```
sudo add-apt-repository -y ppa:ethereum/ethereum
sudo apt-get update
sudo apt-get install ethereum
```


Later to upgrade:

```
sudo apt-get update
sudo apt-get install ethereum
sudo apt-get upgrade geth
```


geth --miner.gaslimit 12000000 \
--http --http.api personal,eth,net,web3,debug \
--ignore-legacy-receipts --allow-insecure-unlock \
--rpc.allow-unprotected-txs   --dev   --nodiscover \
--maxpeers 0 --mine --miner.threads 1   --networkid 1337

geth -miner.gaslimit 12000000 \
--http \
--http.api personal,eth,net,web3,debug \
--allow-insecure-unlock \
--rpc.allow-unprotected-txs \
--http.vhosts '*,localhost,host.docker.internal' \
--http.corsdomain '*' \
--http.addr "0.0.0.0" \
--dev \
--nodiscover --maxpeers 0 --mine \
--miner.threads 1 \
--verbosity 1 \
--ignore-legacy-receipts

running the bundler


yarn hardhat-deploy --network localhost
yarn run bundler

https://docs.stackup.sh/docs/guides/quickstart

https://github.com/eth-infinitism/account-abstraction


Set up:
Running local dev geth node
Deployed local bundler from https://github.com/eth-infinitism/bundler
Verified local node and bundler set up via https://github.com/eth-infinitism/bundler-spec-tests
With this setup, yarn run simpleAccount address produced SimpleAccount address: 0x0000000000000000000000000000000000000000 as the output, with the following logged in the local node:

WARN [03-10|13:33:30.709] Served eth_call  conn=127.0.0.1:52652 reqid=44 duration="581.499Âµs" err="execution reverted"                    
errdata=0x6ca7b8060000000000000000000000000000000000000000000000000000000000000000
Remedy
To remedy this, I installed the smart contract from the account-abstraction project by cloning that project and running the deploy script, e.g. yarn deploy --network localhost

After deploying the account abstraction into the local environment, yarn run simpleAccount address produced an address as expected.


 yarn deploy --network localhost
yarn run v1.22.19
$ ./scripts/hh-wrapper deploy --network localhost
Generating typings for: 95 artifacts in dir: typechain for target: ethers-v5
Successfully generated 220 typings!
Compiled 91 Solidity files successfully
==entrypoint addr= 0x0576a174D229E3cFA37253523E645A78A0C91B57
==SimpleAccountFactory addr= 0x09c58cf6be8E25560d479bd52B4417d15bCA2845
Done in 21.98s.

https://github.com/stackup-wallet/erc-4337-examples/issues/22

